---
title: "R Notebook"
output: html_notebook
---



```{r}
setwd("~/QPL Projects/Project 3")
library(dplyr)
library(readxl)
library(writexl)
```


```{r}
df <- read_excel("Original Datasets/QPL Capital Funds Contract PO report.xlsx", 
    sheet = "TransactionsData (10)")
nyc <- read_excel("Original Datasets/nyc_mwbe_directory.xlsx")
nys <- read_excel("Original Datasets/NYS_MWBE_Directory.xlsx")
```

```{r}
df_mwbe <-  df %>%
  filter( !grepl('LYNGSOE SYSTEMS INC|Ingram Industries Inc|INGRAM LIBRARY SERVICES LLC|BAKER & TAYLOR INC|MIDWEST TAPE LLC', `Prime Vendor`)) 
df_mwbe$`Prime Contract Start Date` <- as.Date(df_mwbe$`Prime Contract Start Date`)
```

```{r}
nyc_nys <- inner_join(nyc, nys, by = "Vendor")
nyc_nys <- nyc_nys %>%
  distinct(Vendor, .keep_all = TRUE)
write_xlsx(nyc_nys, "nyc_nys_merged_mwbe.xlsx")
```

The total sum of Non-MWBE Removed Spending
```{r}
options(digits = 10)
sum(df_mwbe$`Prime Contract Original Amount`)
```

Year 2009 Non-MWBE Removed
```{r}
df_mwbe$`Prime Contract Start Date` <- as.Date(df_mwbe$`Prime Contract Start Date`, format = '%Y-%m-%d')
df_mwbe %>%
  filter(`Prime Contract Start Date` >= as.Date("2009-01-01") & `Prime Contract Start Date` <= as.Date("2009-12-31")) %>%
  pull(`Prime Contract Original Amount`) %>%
  sum

```
Year 2010 Non-MWBE Removed
```{r}
df_mwbe %>%
  filter(`Prime Contract Start Date` >= as.Date("2010-01-01") & `Prime Contract Start Date` <= as.Date("2010-12-31")) %>%
  pull(`Prime Contract Original Amount`) %>%
  sum
```

Year 2011 Non-MWBE Removed
```{r}
df_mwbe %>%
  filter(`Prime Contract Start Date` >= as.Date("2011-01-01") & `Prime Contract Start Date` <= as.Date("2011-12-31")) %>%
  pull(`Prime Contract Original Amount`) %>%
  sum
```


Year 2012 Non-MWBE Removed
```{r}
df_mwbe %>%
  filter(`Prime Contract Start Date` >= as.Date("2012-01-01") & `Prime Contract Start Date` <= as.Date("2012-12-31")) %>%
  pull(`Prime Contract Original Amount`) %>%
  sum
```

Year 2013 Non-MWBE Removed
```{r}
df_mwbe %>%
  filter(`Prime Contract Start Date` >= as.Date("2013-01-01") & `Prime Contract Start Date` <= as.Date("2013-12-31")) %>%
  pull(`Prime Contract Original Amount`) %>%
  sum
```

Year 2014 Non-MWBE Removed
```{r}
df_mwbe %>%
  filter(`Prime Contract Start Date` >= as.Date("2014-01-01") & `Prime Contract Start Date` <= as.Date("2014-12-31")) %>%
  pull(`Prime Contract Original Amount`) %>%
  sum
```

Year 2015 Non-MWBE Removed
```{r}
df_mwbe %>%
  filter(`Prime Contract Start Date` >= as.Date("2015-01-01") & `Prime Contract Start Date` <= as.Date("2015-12-31")) %>%
  pull(`Prime Contract Original Amount`) %>%
  sum
```

Year 2016 Non-MWBE Removed
```{r}
df_mwbe %>%
  filter(`Prime Contract Start Date` >= as.Date("2016-01-01") & `Prime Contract Start Date` <= as.Date("2016-12-31")) %>%
  pull(`Prime Contract Original Amount`) %>%
  sum
```

Year 2017 Non-MWBE Removed
```{r}
df_mwbe %>%
  filter(`Prime Contract Start Date` >= as.Date("2017-01-01") & `Prime Contract Start Date` <= as.Date("2017-12-31")) %>%
  pull(`Prime Contract Original Amount`) %>%
  sum
```

Year 2018 Non-MWBE Removed
```{r}
df_mwbe %>%
  filter(`Prime Contract Start Date` >= as.Date("2018-01-01") & `Prime Contract Start Date` <= as.Date("2018-12-31")) %>%
  pull(`Prime Contract Original Amount`) %>%
  sum
```

Year 2019 Non-MWBE Removed
```{r}
df_mwbe %>%
  filter(`Prime Contract Start Date` >= as.Date("2019-01-01") & `Prime Contract Start Date` <= as.Date("2019-12-31")) %>%
  pull(`Prime Contract Original Amount`) %>%
  sum
```

Year 2020 Non-MWBE Removed
```{r}
df_mwbe %>%
  filter(`Prime Contract Start Date` >= as.Date("2020-01-01") & `Prime Contract Start Date` <= as.Date("2020-12-31")) %>%
  pull(`Prime Contract Original Amount`) %>%
  sum
```

Year 2021 Non-MWBE Removed
```{r}
df_mwbe %>%
  filter(`Prime Contract Start Date` >= as.Date("2021-01-01") & `Prime Contract Start Date` <= as.Date("2021-12-31")) %>%
  pull(`Prime Contract Original Amount`) %>%
  sum
```





The total sum of Non-MWBE Not Removed Spending
```{r}
sum(df$`Prime Contract Original Amount`)
```

Year 2009 Non-MWBE Not Removed
```{r}
df$`Prime Contract Start Date` <- as.Date(df$`Prime Contract Start Date`, format = '%Y-%m-%d')
df %>%
  filter(`Prime Contract Start Date` >= as.Date("2009-01-01") & `Prime Contract Start Date` <= as.Date("2009-12-31")) %>%
  pull(`Prime Contract Original Amount`) %>%
  sum

```
Year 2010 Non-MWBE Not Removed
```{r}
df %>%
  filter(`Prime Contract Start Date` >= as.Date("2010-01-01") & `Prime Contract Start Date` <= as.Date("2010-12-31")) %>%
  pull(`Prime Contract Original Amount`) %>%
  sum
```

Year 2011 Non-MWBE Not Removed
```{r}
df%>%
  filter(`Prime Contract Start Date` >= as.Date("2011-01-01") & `Prime Contract Start Date` <= as.Date("2011-12-31")) %>%
  pull(`Prime Contract Original Amount`) %>%
  sum
```


Year 2012 Non-MWBE Not Removed
```{r}
df %>%
  filter(`Prime Contract Start Date` >= as.Date("2012-01-01") & `Prime Contract Start Date` <= as.Date("2012-12-31")) %>%
  pull(`Prime Contract Original Amount`) %>%
  sum
```

Year 2013 Non-MWBE Not Removed
```{r}
df %>%
  filter(`Prime Contract Start Date` >= as.Date("2013-01-01") & `Prime Contract Start Date` <= as.Date("2013-12-31")) %>%
  pull(`Prime Contract Original Amount`) %>%
  sum
```

Year 2014 Non-MWBE Not Removed
```{r}
df %>%
  filter(`Prime Contract Start Date` >= as.Date("2014-01-01") & `Prime Contract Start Date` <= as.Date("2014-12-31")) %>%
  pull(`Prime Contract Original Amount`) %>%
  sum
```

Year 2015 Non-MWBE Not Removed
```{r}
df %>%
  filter(`Prime Contract Start Date` >= as.Date("2015-01-01") & `Prime Contract Start Date` <= as.Date("2015-12-31")) %>%
  pull(`Prime Contract Original Amount`) %>%
  sum
```

Year 2016 Non-MWBE Not Removed
```{r}
df %>%
  filter(`Prime Contract Start Date` >= as.Date("2016-01-01") & `Prime Contract Start Date` <= as.Date("2016-12-31")) %>%
  pull(`Prime Contract Original Amount`) %>%
  sum
```

Year 2017 Non-MWBE Not Removed
```{r}
df %>%
  filter(`Prime Contract Start Date` >= as.Date("2017-01-01") & `Prime Contract Start Date` <= as.Date("2017-12-31")) %>%
  pull(`Prime Contract Original Amount`) %>%
  sum
```

Year 2018 Non-MWBE Not Removed
```{r}
df %>%
  filter(`Prime Contract Start Date` >= as.Date("2018-01-01") & `Prime Contract Start Date` <= as.Date("2018-12-31")) %>%
  pull(`Prime Contract Original Amount`) %>%
  sum
```

Year 2019 Non-MWBE Not Removed
```{r}
df %>%
  filter(`Prime Contract Start Date` >= as.Date("2019-01-01") & `Prime Contract Start Date` <= as.Date("2019-12-31")) %>%
  pull(`Prime Contract Original Amount`) %>%
  sum
```

Year 2020 Non-MWBE Not Removed
```{r}
df %>%
  filter(`Prime Contract Start Date` >= as.Date("2020-01-01") & `Prime Contract Start Date` <= as.Date("2020-12-31")) %>%
  pull(`Prime Contract Original Amount`) %>%
  sum
```

Year 2021 Non-MWBE Not Removed
```{r}
df %>%
  filter(`Prime Contract Start Date` >= as.Date("2021-01-01") & `Prime Contract Start Date` <= as.Date("2021-12-31")) %>%
  pull(`Prime Contract Original Amount`) %>%
  sum
```